!pip install tensorflow matplotlib

import tensorflow as tf
import keras
import os
import numpy as np
import matplotlib.pyplot as plt

import kagglehub

# Download latest version
path = kagglehub.dataset_download("tongpython/cat-and-dog")

print("Path to dataset files:", path)

# Define the paths to the image directories
data_dir = '/kaggle/input/cat-and-dog/'
train_dir = os.path.join(data_dir, 'training_set/training_set')
test_dir = os.path.join(data_dir, 'test_set/test_set')

# Define image size and batch size
img_height = 128
img_width = 128
batch_size = 32

# Load the training and validation datasets
train_ds = tf.keras.utils.image_dataset_from_directory(
    train_dir,
    labels='inferred',
    label_mode='int',
    image_size=(img_height, img_width),
    interpolation='nearest',
    batch_size=batch_size)

test_ds = tf.keras.utils.image_dataset_from_directory(
    test_dir,
    labels='inferred',
    label_mode='int',
    image_size=(img_height, img_width),
    interpolation='nearest',
    batch_size=batch_size)

# Verify class names
print(train_ds.class_names)
print(test_ds.class_names)

model = keras.Sequential([
  keras.Input(shape=(img_height, img_width, 3)), # Use Input layer for specifying input shape

  # Block 1
  keras.layers.Conv2D(32, (3,3), padding='same', use_bias=False, ),
  keras.layers.BatchNormalization(),
  keras.layers.Activation('relu'),
  keras.layers.MaxPooling2D(2,2),

  # Block 2
  keras.layers.Conv2D(64, (3,3), padding='same', use_bias=False),
  keras.layers.BatchNormalization(),
  keras.layers.Activation('relu'),
  keras.layers.MaxPooling2D(2,2),

  # Block 3
  keras.layers.Conv2D(128, (3,3), padding='same', use_bias=False),
  keras.layers.BatchNormalization(),
  keras.layers.Activation('relu'),
  keras.layers.MaxPooling2D(2,2),
  keras.layers.Dropout(0.3),

  # Block 4
  keras.layers.Conv2D(256, (3,3), padding='same', use_bias=False),
  keras.layers.BatchNormalization(),
  keras.layers.Activation('relu'),
  keras.layers.MaxPooling2D(2,2),
  keras.layers.Dropout(0.3),

  # Flatten + FC
  keras.layers.Flatten(),
  keras.layers.Dense(256, use_bias=False),
  keras.layers.BatchNormalization(),
  keras.layers.Activation('relu'),
  keras.layers.Dropout(0.5),

  # Output layer (binary classification)
  keras.layers.Dense(1, activation='sigmoid')
])

model.summary()

model.compile(
    optimizer='adam',
    loss="binary_crossentropy",
    metrics=['accuracy']
)

history = model.fit(
    train_ds,
    validation_data=test_ds,
    epochs=15
)

model.save("/content/drive/MyDrive/Colab Notebooks/CatDog_15Epoch.keras")

import pandas as pd
history_df = pd.DataFrame(history.history)
history_df.loc[:, ['loss', 'val_loss']].plot()
history_df.loc[:, ['accuracy', 'val_accuracy']].plot()
plt.show()
