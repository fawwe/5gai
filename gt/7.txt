
import tensorflow as tf

from tensorflow.keras.preprocessing.image import ImageDataGenerator

from tensorflow.keras.applications import MobileNetV2          

from tensorflow.keras import layers, models



import os

dataset_dir = r'C:\Users\HP\DLRL\kagglehub\datasets\tongpython\cat-and-dog'

train_dir = os.path.join(dataset_dir, "training_set")

test_dir = os.path.join(dataset_dir, "test_set")

img_size = (224, 224)

batch_size = 32




train_ds = tf.keras.preprocessing.image_dataset_from_directory(
    '/kaggle/input/cat-and-dog/training_set/training_set',
    labels='inferred',
    label_mode='int',
    image_size=img_size,
    interpolation='nearest',
    batch_size=batch_size)


test_ds = tf.keras.preprocessing.image_dataset_from_directory(
    '/kaggle/input/cat-and-dog/test_set/test_set',
    labels='inferred',
    label_mode='int',
    image_size=img_size,
    interpolation='nearest',
    batch_size=batch_size)





base_model = MobileNetV2(weights="imagenet", include_top=False, input_shape=(224, 224, 3))

base_model.trainable = False                                       




model = models.Sequential([
    base_model,
    layers.GlobalAveragePooling2D(),

    layers.Dense(512, use_bias="False"),
    layers.BatchNormalization(),
    layers.Activation('relu'),
    layers.Dropout(0.2),

    layers.Dense(128, use_bias="False"),
    layers.BatchNormalization(),
    layers.Activation('relu'),
    layers.Dropout(0.1),

    layers.Dense(len(train_ds.class_names), activation="softmax")
])




model.compile(optimizer="adam",
              loss="sparse_categorical_crossentropy",
              metrics=["accuracy"])




history = model.fit(
    train_ds,
    validation_data=test_ds,
    epochs=2
)


model.save("PreTrainedCatDog_MobileNetV2_5Epoch_new.h5")




loss, acc = model.evaluate(test_ds)

print(f"Validation Accuracy: {acc*100:.2f}%")



import numpy as np

from tensorflow.keras.preprocessing import image

import os

import kagglehub



path = kagglehub.dataset_download("tongpython/cat-and-dog")



img_path = os.path.join(path, "test_set/test_set/dogs/dog.4870.jpg")


img = image.load_img(img_path, target_size=img_size)

np_img = image.img_to_array(img) / 255.0

img_array = np.expand_dims(np_img, axis=0)


prediction = model.predict(img_array)


print("Predicted:", test_ds.class_names[np.argmax(prediction)])



from sklearn.metrics import confusion_matrix

import numpy as np



test_true_labels = np.concatenate([y for x, y in test_ds], axis=0)




test_predictions = model.predict(test_ds)

test_predicted_labels = np.argmax(test_predictions, axis=1)



cm = confusion_matrix(test_true_labels, test_predicted_labels)



import matplotlib.pyplot as plt

import seaborn as sns


plt.figure(figsize=(10, 8))

sns.heatmap(cm, annot=True, fmt="d", cmap="Blues",
            xticklabels=test_ds.class_names,
            yticklabels=test_ds.class_names)

plt.xlabel("Predicted")

plt.ylabel("True")

plt.title("Confusion Matrix")

plt.show()


